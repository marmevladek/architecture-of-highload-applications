# highload-2025

---

# IoT Parking Service
IoT Parking Service - это сервис, который собирает данные о свободных местах на парковках с помощью IoT-устройств и предоставляет эту информацию автономным автомобилям для бронирования мест и построения маршрутов.

---

# Функциональность проекта
## API
- Обработка данных от IoT-устройств (эмулируемых через Data Simulator) и обновление информации о парковках в базе данных.
- Передача данных о свободных местах на парковках автономным автомобилям в реальном времени.
- Валидация поступающих данных через IoT Controller.
- Проверка данных на соответствие мгновенным и длительным правилам через Rule Engine.
- Хранение событий и состояний парковок для последующего анализа.
- Предоставление возможности автомобилям запросить ближайшую свободную парковку.

## База данных
- InfluxDB — для хранения временных рядов (состояние парковок с метками времени).
- PostgreSQL — для хранения метаданных (например, информация о парковках).

## Балансировщик нагрузки
- Nginx — для распределения запросов между микросервисами.

## Брокер сообщений
- Mosquitto — для передачи данных от IoT-устройств к другим компонентам системы.

## Кэш
- Redis — для быстрого доступа к часто используемым данным (например, текущее состояние парковок: **device_id**, **free_spots**, **timestamp**).

## Loki-стек
- Promtail и Loki — для сбора и анализа логов системы.

## Мониторинг
- Grafana и Prometheus — для визуализации метрик и мониторинга производительности.

---

# Формирование требований
## Максимальное количество пользователей
В проекте учитываются два типа "пользователей": IoT-устройства, передающие данные, и автономные автомобили, запрашивающие информацию.

- Максимальное количество IoT-устройств:
На старте сервис рассчитан на 150 устройств, каждое из которых отправляет данные каждые 4 секунды. В перспективе возможно масштабирование до 1000 устройств для обслуживания крупных городов или сети парковок.

- Максимальное количество автомобилей:
Предполагается поддержка 500-1000 автономных автомобилей в часы пик, каждый с возможностью до 2 активных сессий (например, запрос состояния и бронирование). Итого максимум 1000-2000 сессий.

## Требуемая скорость обработки запросов
- Время отклика на запросы автомобилей:
Целевое время — 200 мс для большей части запросов, допустимый диапазон — 200-500 мс, чтобы обеспечить быструю реакцию для навигации.

- Время обработки внутренних операций:
Простые операции (например, валидация данных в IoT Controller, запись в InfluxDB) — 50 мс. Сложные операции (проверка правил в Rule Engine) — 50-100 мс.

## Объём хранимой информации
- Прогнозируемый объём данных на старте:
С 150 устройствами, отправляющими данные каждые 4 секунды (сообщение ~65 байт), объём составляет:
150 × (86400 ÷ 4) × 65 = ~200.8 МБ/день.
С учётом логов (Loki) и метрик (Prometheus) — ~250 МБ/день.
Данные в PostgreSQL (данные парковок, бронирования) добавляют незначительный объём (~1-5 МБ на старте).

- Возможный рост объёма данных:
При масштабировании до 1000 устройств:
1000 × (86400 ÷ 4) × 65 = ~1.34 ГБ/день.
С учётом логов и метрик — до 1.5-2 ГБ/день.
Рост числа автомобилей добавит данные о бронированиях (~10-20 МБ ежегодно).

---

# Диаграмма прецедентов
![Диаграмма прецедентов](iot_service_uml.svg)